<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>DOGE.watch</title>
  </head>
  <body>
    1 DOGE = <span class="price">1 DOGE</span>
    <select>
      <option value="DOGE">DOGE</option>
      <option value="BTC">BTC</option>
      <option value="USDT">USD</option>
    </select>
  </body>
  
  <script>
    let priceInfo = [{
      currency: 'DOGE',
      price: 1
    }]
    const currentStoreFileName = new Date().toISOString().split("T")[0] + ".json";
    fetch(`../back/price_history/${currentStoreFileName}`)
      .then(function(response) {
        return response.json();
      })
      .then(function(priceJson) {
        if (priceJson.length) {
          priceInfo = priceInfo.concat(priceJson)
          localStorage.setItem('currencies', JSON.stringify(priceJson))
        }
      })
      .catch(err => {
        console.log(err, 'Will try to use old priceinfo')
        priceInfo = localStorage.getItem('currencies')
      })
      .finally(addListeners)
    
    function addListeners() {
      document.querySelector('select').addEventListener('change', event => {
        try {
          document.querySelector(".price").innerText = priceInfo.find(currency => currency.currency === event.target.value).price.toFixed(8)
        } catch (error) {
          console.log(error, '\n Failed to change price')
        }
      })
    }
  </script>
</html>

